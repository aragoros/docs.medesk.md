Репликация данных
=================

В данном разделе предоставлен материал описывающий механизм репликации и
его програмный интерфейс.

Описание механизма репликации:
------------------------------

Под **репликацией данных** в случае работы с MEDESK понимается односторонняя
синхронизация данных: данные на сервере синхронизируются с БД клиента.

Этот механизм необходим при подключении новых клиентов в том случае, когда на
клиентской стороне существуют какие-либо данные, которые клиент хотел бы видеть
в системе. Например, в учреждении есть база данных пациентов или предприятий, с
которыми работает учреждение. Естественно, чтобы продолжить продуктивно работать
с сервером MEDESK необходимо чтобы эти данные так же были видны при работе в
системе. Для этого и существует механизм репликации данных.

В таком механизме предусмотрено последовательное копирование данных в
соответствии с описанными моделями и информации о предыдущих репликацях.
Для более подробного разбора работы механизма репликации уточним некоторые
понятия.

**Модель**, в терминах данной системы - это строго декларированный набор
атрибутов характеризующих определенный тип объекта или субъекта.

Например, модель пациента содержит такие поля общей информации
как "Имя", "Фамилия" и специальные поля, например номер карты
пациента, поля персональных данных и пр.

**Сущность** - экземпляр определенной модели, например, данные об определенном
пациенте, предприи и пр.

Каждая модель, которую возможно репликацировать, предусматривает наличие
специальных полей содержащих информацию о предыдущих репликациях, таких как:

- **Идентификатор репликации** (``repl.id``) - идентификатор, уникальный в рамках
  сущностей одной модели необходимый для связи сущности имеющейся в, например,
  БД клиента и на сервере.

- **Время изменения** (``repl.ts`` (ts от timestamp) ) - поле содержащее
  последнее время изменения данных сущности. Необходимо для снижения нагрузки
  на сервер, т.е. для того чтобы не копировать сущность когда её время
  модификации совпадает в данных клиента и сервера.

- **Хэш данных сущности** (``repl.hash``) - строка фиксированной длинны
  представляющая собой хэшированные данные сущности. Необходима в случае, если
  в данных клиента не проставляется время изменения, т.е. при совпадении
  хэша в данных клиента и сервера сущность не копируется.

- **Общая информация о репликации** (``repl.ref``) - текст содержащий данные,
  необходимые клиенту для сопоставления реплицированной сущности с данными в,
  например, картотеке или БД клиента. То есть человекочитаемая информация о,
  например, номере карты пациента в картотеке, таблице в БД из которой были
  реплицированны данные и пр., т.е. любые дополнительные данные необходимые
  человеку при работе с реплицированной сущностью. Данное поле включено т.к.
  все вышеописанные поля используются исключетельно в API и
  неинформативны для пользователя. Данное поле не имеет какой либо смысловой
  нагрузки в терминах API.
